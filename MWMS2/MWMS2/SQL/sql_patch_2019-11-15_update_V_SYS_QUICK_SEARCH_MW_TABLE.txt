CREATE OR REPLACE VIEW V_SYS_QUICK_SEARCH_MW_TABLE AS 
SELECT DISTINCT --1
--, T1.MW_DSN
--, T2.REFERENCE_NO
--, T3.CERTIFICATION_NO
--, T4.BUILDING_NAME
--, T4.STREE_NAME
--, T1.FILEREF_FOUR||FILEREF_TWO AS FILEREF_FOUR_TWO
--BLOCK_ID
--UNIT_ID

T5.SUBMISSION_NATURE
, T1.MW_DSN
, T1.FIRST_RECEIVED_DATE
, T1.S_FORM_TYPE_CODE
, T2.REFERENCE_NO
--RECEIPT POINT
, T3AP.CERTIFICATION_NO AS CERTIFICATION_NO_AP
, T3PRC.CERTIFICATION_NO AS CERTIFICATION_NO_PRC
, T1.LOCATION_OF_MINOR_WORK
, T4.STREE_NAME
, T4.STREET_NO
, T4.BUILDING_NAME
, T4.FLOOR
, T4.FLAT
--P_MW_RECORD_ITEM
, T1.SITE_AUDIT_RELATED
, T1.PRE_SITE_AUDIT_RELATED
, T1.AUDIT_RELATED
, T1.VERIFICATION_SPO
--description
, T1.COMMENCEMENT_DATE
, T1.COMPLETION_DATE
--Items related to Signboard
--Order Related
--Referral Date
, T6OWNER.NAME_ENGLISH AS NAME_ENGLISH_OWNER
, T6OWNER.CONTACT_NO AS CONTACT_NO_OWNER
, T6OI.NAME_ENGLISH AS NAME_ENGLISH_OI
, T6OI.CONTACT_NO AS CONTACT_NO_OI
--Remark
--Reply Letter Date
--SDF
--Previously Related MW NO.
--Barcode
--SUBMISSION RESULT
--, T1.FILEREF_FOUR||T1.FILEREF_TWO AS FILEREF_FOUR_TWO
, T7.FILEREF_FOUR_TWO  AS FILEREF_FOUR_TWO

FROM P_MW_RECORD T1
LEFT JOIN P_MW_REFERENCE_NO T2 ON T2.UUID = T1.REFERENCE_NUMBER
LEFT JOIN P_MW_APPOINTED_PROFESSIONAL T3AP ON T3AP.MW_RECORD_ID = T1.UUID AND T3AP.IDENTIFY_FLAG = 'AP' AND T3AP.CERTIFICATION_NO IS NOT NULL 
LEFT JOIN P_MW_APPOINTED_PROFESSIONAL T3PRC ON T3PRC.MW_RECORD_ID = T1.UUID AND T3PRC.IDENTIFY_FLAG = 'PRC' AND T3PRC.CERTIFICATION_NO IS NOT NULL 
LEFT JOIN P_MW_ADDRESS T4 ON T4.UUID = T1.LOCATION_ADDRESS_ID
LEFT JOIN P_MW_DSN T5 ON T5.DSN = T1.MW_DSN
LEFT JOIN P_MW_PERSON_CONTACT T6OWNER ON T6OWNER.UUID = T1.OWNER_ID
LEFT JOIN P_MW_PERSON_CONTACT T6OI ON T6OI.UUID = T1.OI_ID
LEFT JOIN (
SELECT MW_RECORD_ID
,LISTAGG(FILEREF_FOUR||'/'||FILEREF_TWO,',')WITHIN GROUP (ORDER BY FILEREF_FOUR) AS FILEREF_FOUR_TWO
FROM   P_MW_FILEREF
GROUP  BY MW_RECORD_ID) T7 ON T2.REFERENCE_NO=T7.MW_RECORD_ID
WHERE T1.IS_DATA_ENTRY ='N'
;