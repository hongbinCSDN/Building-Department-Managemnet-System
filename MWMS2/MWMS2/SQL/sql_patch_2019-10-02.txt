CREATE TABLE SYS_Quick_Search
	(
  UUID        VARCHAR2(36),
	KEYWORD           VARCHAR2 (200) NOT NULL,
	RECORD_UUID       VARCHAR2 (36),
	RECORD_TYPE       VARCHAR2 (15),
	REGISTRATION_NO   VARCHAR2 (20),
	APPLICANT_SURNAME    VARCHAR2 (40),
  APPLICANT_GIVEN_NAME    VARCHAR2 (40),
	APPLICANT_CHINESE_NAME NVARCHAR2 (50),
  COMP_NAME  VARCHAR2(150),
  COMP_CHI_NAME NVARCHAR2(50),
  AS_SURNAME VARCHAR2(40),
  AS_GIVEN_NAME VARCHAR2(40),
  AS_CHI_NAME NVARCHAR2(50),
  HKID VARCHAR2(300),
  PASSPORT VARCHAR2(300),
  UKEY VARCHAR2(100),
	KEYWORD_TYPE           VARCHAR2 (100),
	COMP_IND_TYPE          VARCHAR2 (1),
	EXPIRY_DATE            DATE
  , primary key(UUID)
	)


CREATE OR REPLACE VIEW MWMS2.SYS_QUICK_SEARCH_COMP_VIEW
AS
SELECT capp.UUID,capp.REGISTRATION_TYPE,capp.FILE_REFERENCE_NO,capplicant.SURNAME , capplicant.GIVEN_NAME_ON_ID,
     capplicant.CHINESE_NAME , capp.ENGLISH_COMPANY_NAME,capp.CHINESE_COMPANY_NAME,
     capplicant.SURNAME AS AS_SURNAME, capplicant.GIVEN_NAME_ON_ID AS AS_GIVEN_NAME, 
     capplicant.CHINESE_NAME AS AS_CHI_NAME,
     capplicant.HKID ,capplicant.PASSPORT_NO,
     	 NVL(capplicant.HKID,capplicant.PASSPORT_NO) AS UKEY,
     	 capp.EXPIRY_DATE
	 FROM C_COMP_APPLICATION capp
	INNER JOIN C_COMP_APPLICANT_INFO cinfo ON cinfo.MASTER_ID = capp.UUID
	INNER JOIN C_APPLICANT capplicant ON cinfo.APPLICANT_ID = capplicant.UUID;


CREATE OR REPLACE VIEW MWMS2.SYS_QUICK_SEARCH_IND_VIEW
AS
SELECT capp.UUID,
capp.REGISTRATION_TYPE,
c.CERTIFICATION_NO,
capplicant.SURNAME,
capplicant.GIVEN_NAME_ON_ID,
capplicant.CHINESE_NAME,
capplicant.HKID,capplicant.PASSPORT_NO,
NVL(capplicant.HKID,capplicant.PASSPORT_NO) AS UKEY,
c.EXPIRY_DATE
FROM C_IND_APPLICATION capp
INNER JOIN C_APPLICANT capplicant ON capp.APPLICANT_ID = capplicant.UUID 
INNER JOIN C_IND_CERTIFICATE c ON c.MASTER_ID = capp.UUID;





DROP TABLE MWMS2.SYS_QUICK_SEARCH CASCADE CONSTRAINTS;

CREATE TABLE MWMS2.SYS_QUICK_SEARCH
	(
	UUID                   VARCHAR2 (36),
	KEYWORD                VARCHAR2 (200) NOT NULL,
	RECORD_UUID            VARCHAR2 (36),
	RECORD_TYPE            VARCHAR2 (15),
	REGISTRATION_NO        VARCHAR2 (20),
	APPLICANT_SURNAME      VARCHAR2 (40),
	APPLICANT_GIVEN_NAME   VARCHAR2 (40),
	APPLICANT_CHINESE_NAME NVARCHAR2 (50),
	COMP_NAME              VARCHAR2 (150),
	COMP_CHI_NAME          NVARCHAR2 (50),
	AS_SURNAME             VARCHAR2 (40),
	AS_GIVEN_NAME          VARCHAR2 (40),
	AS_CHI_NAME            NVARCHAR2 (50),
	HKID                   VARCHAR2 (300),
	PASSPORT               VARCHAR2 (300),
	UKEY                   VARCHAR2 (100),
	KEYWORD_TYPE           VARCHAR2 (100),
	COMP_IND_TYPE          VARCHAR2 (1),
	EXPIRY_DATE            DATE
	)
	TABLESPACE USERS
	STORAGE (BUFFER_POOL DEFAULT);


DROP VIEW MWMS2.SYS_QUICK_SEARCH_COMP_VIEW;

CREATE OR REPLACE VIEW MWMS2.SYS_QUICK_SEARCH_COMP_VIEW
AS
SELECT capp.UUID,capp.REGISTRATION_TYPE,capp.FILE_REFERENCE_NO,capplicant.SURNAME , capplicant.GIVEN_NAME_ON_ID,
     capplicant.CHINESE_NAME , capp.ENGLISH_COMPANY_NAME,capp.CHINESE_COMPANY_NAME,
     capplicant.SURNAME AS AS_SURNAME, capplicant.GIVEN_NAME_ON_ID AS AS_GIVEN_NAME, 
     capplicant.CHINESE_NAME AS AS_CHI_NAME,
     capplicant.HKID ,capplicant.PASSPORT_NO,
     	 NVL(capplicant.HKID,capplicant.PASSPORT_NO) AS UKEY,
     	 capp.EXPIRY_DATE
	 FROM C_COMP_APPLICATION capp
	INNER JOIN C_COMP_APPLICANT_INFO cinfo ON cinfo.MASTER_ID = capp.UUID
	INNER JOIN C_APPLICANT capplicant ON cinfo.APPLICANT_ID = capplicant.UUID;



DROP VIEW MWMS2.SYS_QUICK_SEARCH_IND_VIEW;

CREATE OR REPLACE VIEW MWMS2.SYS_QUICK_SEARCH_IND_VIEW
AS
SELECT capp.UUID,
capp.REGISTRATION_TYPE,
capp.FILE_REFERENCE_NO,
capplicant.SURNAME,
capplicant.GIVEN_NAME_ON_ID,
capplicant.CHINESE_NAME,
capplicant.HKID,capplicant.PASSPORT_NO,
NVL(capplicant.HKID,capplicant.PASSPORT_NO) AS UKEY,
c.EXPIRY_DATE
FROM C_IND_APPLICATION capp
INNER JOIN C_APPLICANT capplicant ON capp.APPLICANT_ID = capplicant.UUID 
INNER JOIN C_IND_CERTIFICATE c ON c.MASTER_ID = capp.UUID;



CREATE OR REPLACE PROCEDURE MWMS2.SYS_QUICK_SEARCH_SP  AS

BEGIN

EXECUTE IMMEDIATE 'DELETE MWMS2.SYS_QUICK_SEARCH cascade';


INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.FILE_REFERENCE_NO,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'REGISTRATION_NO' AS keywordType , 'C' AS CI , v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v );
  
INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.ENGLISH_COMPANY_NAME,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'COMP_NAME' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.ENGLISH_COMPANY_NAME IS NOT NULL );
  
INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.CHINESE_COMPANY_NAME,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'COMP_CHI_NAME' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.CHINESE_COMPANY_NAME IS NOT NULL);   


INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.AS_SURNAME,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'AS_SURNAME' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.AS_SURNAME IS NOT NULL);

  
INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.AS_GIVEN_NAME,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'AS_GIVEN_NAME' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.AS_GIVEN_NAME IS NOT NULL);
  
  
INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.AS_CHI_NAME,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'AS_CHI_NAME' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.AS_CHI_NAME IS NOT NULL);
  
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.HKID,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'HKID' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.HKID IS NOT NULL);
   
 
   
   
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.PASSPORT_NO,v.UUID,v.REGISTRATION_TYPE,v.FILE_REFERENCE_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , v.ENGLISH_COMPANY_NAME, v.CHINESE_COMPANY_NAME,   v.AS_SURNAME, v.AS_GIVEN_NAME, v.AS_CHI_NAME, v.HKID ,v.PASSPORT_NO,v.UKEY
,'PASSPORT' AS keywordType, 'C' AS CI, v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_COMP_VIEW v WHERE v.PASSPORT_NO IS NOT NULL); 
   
  
  
  
  
    
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.CERTIFICATION_NO,v.UUID,v.REGISTRATION_TYPE,v.CERTIFICATION_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME ,  NULL, NULL,   NULL, NULL, NULL,v.HKID ,v.PASSPORT_NO,v.UKEY
,'REGISTRATION_NO' AS keywordType, 'I' AS CI ,v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_IND_VIEW v WHERE v.CERTIFICATION_NO IS NOT NULL); 
  
  
     
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.SURNAME,v.UUID,v.REGISTRATION_TYPE,v.CERTIFICATION_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME ,  NULL, NULL,   NULL, NULL, NULL, v.HKID ,v.PASSPORT_NO,v.UKEY
,'APPLICANT_SURNAME' AS keywordType, 'I' AS CI,v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_IND_VIEW v WHERE v.SURNAME IS NOT NULL);  
  

     
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.GIVEN_NAME_ON_ID,v.UUID,v.REGISTRATION_TYPE,v.CERTIFICATION_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME ,  NULL, NULL,   NULL, NULL, NULL, v.HKID ,v.PASSPORT_NO,v.UKEY
,'APPLICANT_GIVEN_NAME' AS keywordType, 'I' AS CI,v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_IND_VIEW v WHERE v.GIVEN_NAME_ON_ID IS NOT NULL);  
  
     
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 ( SELECT sys_guid() AS uuid, v.HKID,v.UUID,v.REGISTRATION_TYPE,v.CERTIFICATION_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , NULL, NULL,   NULL, NULL, NULL, v.HKID ,v.PASSPORT_NO,v.UKEY
,'HKID' AS keywordType, 'I' AS CI,v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_IND_VIEW v WHERE v.HKID IS NOT NULL);

  
  
      
 INSERT INTO MWMS2.SYS_QUICK_SEARCH 
(UUID, KEYWORD, RECORD_UUID, RECORD_TYPE, REGISTRATION_NO, APPLICANT_SURNAME, APPLICANT_GIVEN_NAME, APPLICANT_CHINESE_NAME, COMP_NAME, COMP_CHI_NAME, AS_SURNAME, AS_GIVEN_NAME, AS_CHI_NAME, HKID, PASSPORT, UKEY, KEYWORD_TYPE,COMP_IND_TYPE,EXPIRY_DATE)
 (SELECT sys_guid() AS uuid,v.PASSPORT_NO,v.UUID,v.REGISTRATION_TYPE,v.CERTIFICATION_NO,v.SURNAME , v.GIVEN_NAME_ON_ID, v.CHINESE_NAME , NULL, NULL,   NULL, NULL, NULL, v.HKID ,v.PASSPORT_NO,v.UKEY
 ,'PASSPORT_NO' AS keywordType, 'I' AS CI,v.EXPIRY_DATE
  FROM SYS_QUICK_SEARCH_IND_VIEW v WHERE v.PASSPORT_NO IS NOT NULL);

--ALTER INDEX QS_Key rebuild;--


EXECUTE IMMEDIATE 'DELETE SYS_QUICK_SEARCH_MW_TABLE cascade';











COMMIT;

END;



